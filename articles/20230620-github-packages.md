---
title: "GitHub Packages ã® npm ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚’ä½¿ã£ã¦ã€ç¤¾å†… org ç”¨ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¬é–‹ã™ã‚‹æ‰‹é †ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æ‰‹é †"
emoji: "ğŸ"
published: true
publication_name: "moneyforward"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["github", "npm", "githubpackages", "githubactions"]
---

è¤‡æ•°ã®ãƒªãƒã‚¸ãƒˆãƒªã§å…±æœ‰ã™ã‚‹ node ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã€ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãª npm ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã§ã¯ãªã GitHub Packages ã® npm ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«å…¬é–‹ã—ã¦ã€ GitHub Organization å†…ã§ã®ã¿åˆ©ç”¨å¯èƒ½ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦æ‰±ã†æ‰‹é †ã‚’ã€ç¤¾å†…å…±æœ‰ç”¨ã«ã¾ã¨ã‚ã¦ã„ãã¾ã™ã€‚

æœ¬è¨˜äº‹ã®å†…å®¹ã¯ã€ä»¥ä¸‹ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚ã°ã ã„ãŸã„åˆ†ã‹ã‚Šã¾ã™ã€‚

https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-npm-registry

## èƒŒæ™¯

ãƒãƒãƒ¼ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ ã‚¯ãƒ©ã‚¦ãƒ‰ã‚·ãƒªãƒ¼ã‚ºã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã‚ˆã†ã¨ã—ã¦ãŠã‚Šã€è¤‡æ•°ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã§å…±é€šã—ã¦åˆ©ç”¨ã§ãã‚‹æ±ç”¨çš„ãª UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æƒãˆãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆå‘ã‘ã«å…¬é–‹ã—ãŸã„ã€‚æ¤œè¨¼æ®µéšãªã®ã§ã€ä¸€æ—¦ org å†…ã«é™å®šã—ãŸçŠ¶æ…‹ã§åˆ©ç”¨ã—ãŸã„ã€‚

## GitHub Packages ã¨ã¯

[Introduction to GitHub Packages - GitHub Docs](https://docs.github.com/en/packages/learn-github-packages/introduction-to-github-packages) ã‚ˆã‚Š

> GitHub Packages is a software package hosting service that allows you to host your software packages privately or publicly and use packages as dependencies in your projects.

> GitHub Packages offers different package registries for commonly used package managers, such as npm, RubyGems, Apache Maven, Gradle, Docker, and NuGet.

GitHub Packages ã¨ã¯ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã«ãƒ›ã‚¹ãƒˆã—ã¦åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ã“ã‚Œã‚’ä½¿ã†ã“ã¨ã§ã€ç‰¹å®šã® org å†…ã§ã®ã¿åˆ©ç”¨å¯èƒ½ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ›ã‚¹ãƒˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

GitHub Packages ã®ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¯ã€ npm ã‚„ RubyGems ãªã©ã®å„è¨€èªã®æ¨™æº–çš„ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚ä»Šå›ã¯ npm ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã®å ´åˆã®å…¬é–‹æ‰‹é †ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †ã«ã¤ã„ã¦æ›¸ã„ã¦ã„ãã¾ã™ã€‚

## å…¬é–‹ã™ã‚‹

### 1. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ­ãƒ¼ã‚«ãƒ«ã® `.npmrc` ã« `authToken` ã¨ `registry` ã‚’è¨­å®šã™ã‚‹

å…¬é–‹ã—ãŸã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›´ä¸‹ã® `.npmrc` ã«ã€ç’°å¢ƒå¤‰æ•° `NPM_TOKEN` ã§ authToken ã‚’å—ã‘å–ã‚‹è¨­å®šã¨ã€å…¬é–‹ç¯„å›²ã‚’æŒ‡å®šã—ãŸ registry URL ã‚’è¨­å®šã—ã¾ã™ã€‚ä¾‹ãˆã°ã€ `moneyforward` org å†…ã«é™å®šã—ãŸå ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã« `@moneyforward` ã‚’ä»˜ä¸ã—ã¾ã™ã€‚

```filename:.npmrc
//npm.pkg.github.com/:_authToken=${NPM_TOKEN}
@moneyforward:registry=https://npm.pkg.github.com
```

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ«ãƒ¼ãƒˆã® `~/.npmrc` ã« `authToken` ã®è¨­å®šã‚’è¨˜è¿°ã—ã€å¾Œè¿°ã® PAT ã‚’ç›´æ¥ä»£å…¥ã—ã¦ã„ã¾ã™ãŒã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªè¨­å®šã«ã™ã‚‹ã“ã¨ã§èªè¨¼ãŒæš—é»™çš„ã«ãªã£ã¦ã—ã¾ã†ãŸã‚ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã® `.npmrc` ã«è¨˜è¿°ã™ã‚‹ã“ã¨ã§ã€ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹èªè¨¼ãŒå¿…è¦ã§ã‚ã‚‹ã“ã¨ã‚’ã‚ˆã‚Šæ˜ç¢ºã«ã—ã¦ã„ã¾ã™ã€‚

ã¾ãŸã€ç’°å¢ƒå¤‰æ•° `NPM_TOKEN` ã¨ã—ã¦å—ã‘å–ã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚„ GitHub Actions ãªã©å¾Œè¿°ã™ã‚‹å„åˆ©ç”¨ã‚·ãƒ¼ãƒ³ã«ãŠã‘ã‚‹èªè¨¼çµŒè·¯ã‚’å…±é€šåŒ–ã—ã¦åˆ†ã‹ã‚Šã‚„ã™ãã™ã‚‹æ„å›³ã‚‚ã‚ã‚Šã¾ã™ã€‚

### 2. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å…¬é–‹ç”¨ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šã™ã‚‹

#### ãƒ­ãƒ¼ã‚«ãƒ«ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‹ã‚‰å…¬é–‹ã™ã‚‹å ´åˆ: Personal Access Token (Classic) ã‚’ç™ºè¡Œã™ã‚‹

GitHub Packages ã‚’ä½¿ã£ã¦ org å†…ã«é™å®šã—ãŸãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‹ã‚‰å…¬é–‹ã™ã‚‹ã«ã¯ã€ Personal Access Token (Classic) ã®ç™ºè¡ŒãŒå¿…è¦ã§ã™ã€‚

[Creating a personal access token - GitHub Docs](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token#creating-a-personal-access-token-classic) ã«å¾“ã„ã€ä»¥ä¸‹ã®æ¨©é™ã‚’æŒã¤ PAT ã‚’ç™ºè¡Œã—ã¦ãã ã•ã„ã€‚

- [x] `repo`
- [x] `read:packages`
- [x] `write:packages`

ã¾ãŸã€å…¬é–‹ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å‰Šé™¤ã‚’è¡Œã„ãŸã„å ´åˆã¯ä»¥ä¸‹ã®æ¨©é™ã‚’åŠ ãˆã¦ãã ã•ã„ã€‚

- [x] `delete:packages`

æ¨©é™è¨­å®šã®è©³ç´°ã¯ [About permissions for GitHub Packages - GitHub Docs](https://docs.github.com/en/packages/learn-github-packages/about-permissions-for-github-packages) ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

PAT ã‚’ç™ºè¡Œã—ãŸã‚‰ã€åˆ©ç”¨ã—ã¦ã„ã‚‹ shell ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« (`.zshrc` ãªã©) ã«ãƒˆãƒ¼ã‚¯ãƒ³ã®å€¤ã‚’ç’°å¢ƒå¤‰æ•° `NPM_TOKEN` ã¨ã—ã¦ export ã™ã‚‹è¨˜è¿°ã‚’è¿½åŠ ã—ã¦ã€æ‰‹é † 1 ã§ä½œæˆã—ãŸ `.npmrc` ã«èª­ã¿è¾¼ã¾ã›ã¦èªè¨¼ã—ã¾ã™ã€‚

```filename:~/.zshrc
export NPM_TOKEN=<YOUR_GITHUB_PAT>
```

#### GitHub Actions ã§å…¬é–‹ã™ã‚‹å ´åˆ: `GITHUB_TOKEN` ã‚’ä½¿ç”¨ã™ã‚‹

GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ GitHub Packages ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¬é–‹ã™ã‚‹å ´åˆã¯ `GITHUB_TOKEN` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ã«ã€`actions/setup-node` ã‚’ä½¿ç”¨ã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—ã¨ `publish` ã‚ã‚‹ã„ã¯ `install` (`npm` ã®å ´åˆã¯ `ci`) ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—ã§ã€ç’°å¢ƒå¤‰æ•° `NPM_TOKEN` ã« `secrets.GITHUB_TOKEN` ã‚’æŒ‡å®šã—ã¦ã€æ‰‹é † 1 ã§ä½œæˆã—ãŸ `.npmrc` ã«èª­ã¿è¾¼ã¾ã›ã¦èªè¨¼ã—ã¾ã™ã€‚

```yml
- name: Setup Node.js
  uses: actions/setup-node@v3
  with:
    node-version-file: .node-version
  env:
    NPM_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

```yml
- name: Publish
  run: npm publish
  env:
    NPM_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### 3. `package.json` ã«å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¨­å®šã™ã‚‹

å…¬é–‹ã—ãŸã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® `package.json` ã«ã€å¿…è¦æœ€ä½é™ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¨­å®šã—ã¦ã„ãã¾ã™ã€‚ å®Ÿéš›ã«ã¯ `main` ã‚„ `files` ãªã©ã€ä»–æ‰€ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦è¨­å®šã™ã¹ããƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ä»–ã«ã‚‚ã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã¯çœç•¥ã—ã¾ã™ã€‚

1. ã¾ãš `name` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®åå‰ã‚’è¨­å®šã—ã¾ã™ã€‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã«ã¯å…¬é–‹ã™ã‚‹ç¯„å›²ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ç¤ºã™ãŸã‚ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€ `moneyforward` org ã§ `foo` ã¨ã„ã†åå‰ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¬é–‹ã—ãŸã„å ´åˆã¯ `@moneyforward/foo` ã¨ã—ã¾ã™ã€‚
2. æ¬¡ã« `version` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã« `x.y.z` ã®å½¢å¼ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ˜è¨˜ã—ã¾ã™ã€‚ `npm publish` ã‚’å®Ÿè¡Œã™ã‚‹éš›ã«æ—¢ã«åŒã˜ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¦ã„ã‚‹å ´åˆã€ publish ã¯å¤±æ•—ã—ã¾ã™ã€‚
3. æœ€å¾Œã« `repository` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¨­å®šã—ã€`url` ã«ç®¡ç†ã—ã¦ã„ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã‚’ç´ã¥ã‘ã¾ã™ã€‚

ä»¥ä¸‹ã¯ `moneyforward` org å†…ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ `foo` ã‚’å…¬é–‹ã™ã‚‹æ™‚ã® `package.json` ã§ã®è¨­å®šä¾‹ã§ã™ã€‚

```json:foo/package.json
{
  "name": "@moneyforward/foo",
  "version": "0.0.0",
  "repository": {
    "type": "git",
    "url": "https://github.com/moneyforward/foo.git",
  },
  ...
}
```

#### monorepo å†…ã®ä¸€éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¬é–‹ã—ãŸã„æ™‚

ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚

https://dev.classmethod.jp/articles/github-packages-private/

ã‚ã‚‹ãƒªãƒã‚¸ãƒˆãƒªãŒ pnpm workspace ãªã©ã‚’ä½¿ã£ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã« packages/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã«ãã‚Œãã‚Œç‹¬ç«‹ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ `bar`, `baz` ã‚’æŒã¤ monorepo æ§‹æˆã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚

```zsh
bar-monorepo/
â”œâ”€â”€ packages/
|   â”œâ”€â”€ bar/
|   |   â”œâ”€â”€ ...
|   |   â””â”€â”€ package.json
|   â””â”€â”€ baz/
|       â”œâ”€â”€ ...
|       â””â”€â”€ package.json
â”œâ”€â”€ ...
â”œâ”€â”€ pnpm-workspace.yaml
â””â”€â”€ package.json
```

ã“ã®ã‚ˆã†ãª monorepo å†…ã®ä¸€éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¬é–‹ã—ãŸã„å ´åˆã¯ã€å¯¾è±¡ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã® `package.json` ã® `repository` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å†…ã« `directory` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã—ã¾ã™ã€‚

ä»¥ä¸‹ã¯ monorepo æ§‹æˆã«ãŠã„ã¦ã€ `moneyforward` org å†…ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ `bar` ã‚’å…¬é–‹ã™ã‚‹æ™‚ã® `packages/bar/package.json` ã§ã®è¨­å®šä¾‹ã§ã™ã€‚

```json:bar-monorepo/packages/bar/package.json
{
  "name": "@moneyforward/bar",
  "version": "0.0.0",
  "repository": {
    "type": "git",
    "url": "https://github.com/moneyforward/bar-monorepo.git",
    "directory": "packages/bar"
  },
  ...
}
```

#### 4. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¬é–‹ã™ã‚‹

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¬é–‹ã™ã‚‹ã«ã¯ `publish` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

[npm-publish | npm Docs](https://docs.npmjs.com/cli/v9/commands/npm-publish)

```zsh
npm publish
```

npm ä»¥å¤–ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã«ã‚‚åŒæ§˜ã®ã‚³ãƒãƒ³ãƒ‰ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

[pnpm publish | pnpm](https://pnpm.io/cli/publish)

```zsh
pnpm publish
```

[yarn publish | Yarn](https://classic.yarnpkg.com/lang/en/docs/cli/publish/)

```zsh
yarn publish
```

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹

### 1. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆã® `.npmrc` ã« `authToken` ã¨ `registry` ã‚’è¨­å®šã™ã‚‹

å…¬é–‹æ‰‹é † 1 ã¨åŒæ§˜ã«ã€GitHub Packages ã«å…¬é–‹ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å…ˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® `.npmrc` ã«ã€ç’°å¢ƒå¤‰æ•° `NPM_TOKEN` ã§ authToken ã‚’å—ã‘å–ã‚‹è¨­å®šã¨ã€å…¬é–‹ç¯„å›²ã‚’æŒ‡å®šã—ãŸ registry URL ã‚’è¨­å®šã—ã¾ã™ã€‚

```filename:.npmrc
//npm.pkg.github.com/:_authToken=${NPM_TOKEN}
@moneyforward:registry=https://npm.pkg.github.com
```

### 2. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç”¨ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šã™ã‚‹

GitHub Packages ã«ãƒ›ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ org å†…ã«é–‰ã˜ãŸãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å ´åˆã€å…¬é–‹æ‰‹é † 2 ã¨åŒæ§˜ã«ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚„ GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãªã©ã‚ã‚‰ã‚†ã‚‹ã‚·ãƒ¼ãƒ³ã§èªè¨¼ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

#### ãƒ­ãƒ¼ã‚«ãƒ«ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å ´åˆ: Personal Access Token (Classic) ã‚’ç™ºè¡Œã™ã‚‹

GitHub Packages ã«å…¬é–‹ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯ã€ Personal Access Token (Classic) ã®ç™ºè¡ŒãŒå¿…è¦ã§ã™ã€‚

[Creating a personal access token - GitHub Docs](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token#creating-a-personal-access-token-classic) ã«å¾“ã„ã€ä»¥ä¸‹ã®æ¨©é™ã‚’æŒã¤ PAT ã‚’ç™ºè¡Œã—ã¦ãã ã•ã„ã€‚

- [x] `repo`
- [x] `read:packages`

PAT ã‚’ç™ºè¡Œã—ãŸã‚‰ã€ shell ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« `.zshrc` ãªã©ã«ãƒˆãƒ¼ã‚¯ãƒ³ã®å€¤ã‚’ç’°å¢ƒå¤‰æ•° `NPM_TOKEN` ã¨ã—ã¦ export ã™ã‚‹è¨˜è¿°ã‚’è¿½åŠ ã—ã¦ã€æ‰‹é † 1 ã§ä½œæˆã—ãŸ `.npmrc` ã«èª­ã¿è¾¼ã¾ã›ã¦èªè¨¼ã—ã¾ã™ã€‚

```filename:~/.zshrc
export NPM_TOKEN=<YOUR_GITHUB_PAT>
```

#### GitHub Actions ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å ´åˆ: `GITHUB_TOKEN` ã‚’ä½¿ç”¨ã™ã‚‹

GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ GitHub Packages ã«å…¬é–‹ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã†å ´åˆã¯ã€ `GITHUB_TOKEN` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ã«ã€`actions/setup-node` ã‚’ä½¿ç”¨ã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—ã¨ install ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—ã§ã€ç’°å¢ƒå¤‰æ•° `NPM_TOKEN` ã« `secrets.GITHUB_TOKEN` ã‚’æŒ‡å®šã—ã¦ã€æ‰‹é † 1 ã§ä½œæˆã—ãŸ `.npmrc` ã«èª­ã¿è¾¼ã¾ã›ã¦èªè¨¼ã—ã¾ã™ã€‚

```yml
- name: Setup Node.js
  uses: actions/setup-node@v3
  with:
    node-version-file: .node-version
  env:
    NPM_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

```yml
- name: Install dependencies
  run: npm ci
  env:
    NPM_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### 3. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ä¸Šã‹ã€ `package.json` ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’æŒ‡å®šã—ã¦ã‹ã‚‰ `install` ã¾ãŸã¯ `add` ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```shell
npm install @moneyforward/foo
# pnpm add @moneyforward/foo
# yarn add @moneyforward/foo
```

or

```json:package.json
{
  "dependencies": {
    "@moneyforward/foo": "0.0.0"
  }
}
```

```shell
npm install
# pnpm install
# yarn install
```

## ã¾ã¨ã‚

- ç‰¹å®šã® org ã«é™å®šã—ãŸãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¬é–‹ã™ã‚‹ã«ã¯ GitHub Packages ã‚’ä½¿ã†ã¨ç°¡å˜ã«ã§ãã‚‹
- ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¬é–‹ã™ã‚‹å ´åˆã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯ PAT ã‚’ç™ºè¡Œã—ã¦ã€ GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ã¯ `actions/setup-node` ã¨ `publish` ã‚³ãƒãƒ³ãƒ‰ã®å„ã‚¹ãƒ†ãƒƒãƒ—ã§ `GITHUB_TOKEN` ã‚’ä½¿ã£ã¦èªè¨¼ã™ã‚‹
- GitHub Packages ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å ´åˆã¯ã€å…¬é–‹ã™ã‚‹å ´åˆã¨åŒæ§˜ã«ã€ã‚ã‚‰ã‚†ã‚‹åˆ©ç”¨ã‚·ãƒ¼ãƒ³ã§ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚ˆã‚‹èªè¨¼ãŒå¿…è¦ã«ãªã‚‹
- å…¬é–‹ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® `package.json` ã«ã¯ã€`name`, `version`, `repository` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¨­å®šã—ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã«ã¯ `@moneyforward/foo` ã®ã‚ˆã†ã«å…¬é–‹ç¯„å›²ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ç¤ºã—ãŸãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä»˜ã‘ã‚‹
- monorepo ã®ä¸€éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¬é–‹ã™ã‚‹å ´åˆã«ã¯ã€å¯¾è±¡ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã® `package.json` ã® `repository` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å†…ã« `directory` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã™ã‚‹

## é–¢é€£ URL

- [Introduction to GitHub Packages - GitHub Docs](https://docs.github.com/en/packages/learn-github-packages/introduction-to-github-packages)
- [Working with the npm registry - GitHub Docs](https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-npm-registry)
- [Creating a personal access token - GitHub Docs](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token#creating-a-personal-access-token-classic)
- [About permissions for GitHub Packages - GitHub Docs](https://docs.github.com/en/packages/learn-github-packages/about-permissions-for-github-packages)
- [Publishing Node.js packages - GitHub Docs](https://docs.github.com/en/actions/publishing-packages/publishing-nodejs-packages)
- [Installing a package - GitHub Docs](https://docs.github.com/en/packages/learn-github-packages/installing-a-package)
- [ãƒ¢ãƒãƒªãƒã®ä¸€éƒ¨ã‚’ GitHub Packages ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ NPM ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§å…¬é–‹ã™ã‚‹ | DevelopersIO](https://dev.classmethod.jp/articles/github-packages-private/)
- [npm-publish | npm Docs](https://docs.npmjs.com/cli/v9/commands/npm-publish)
- [pnpm publish | pnpm](https://pnpm.io/cli/publish)
- [yarn publish | Yarn](https://classic.yarnpkg.com/lang/en/docs/cli/publish/)
